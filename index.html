<!DOCTYPE html>
<html>
<head>
    <title>Canlı Görüntülü Sohbet</title>
    <style>
        #video-grid { display: grid; grid-template-columns: repeat(auto-fill, 300px); grid-gap: 10px; }
        video { width: 100%; background: #222; border-radius: 10px; }
    </style>
</head>
<body>
    <h3>Senin ID: <span id="my-id">...</span></h3>
    <input type="text" id="peer-id" placeholder="Bağlanılacak ID">
    <button onclick="connectToPeer()">Bağlan</button>
    
    <div id="video-grid"></div>

    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script>
        const peer = new Peer(undefined, {
            path: '/myapp',
            host: '/',
            port: '443'
        });

        const videoGrid = document.getElementById('video-grid');
        const myVideo = document.createElement('video');
        myVideo.muted = true;

        navigator.mediaDevices.getUserMedia({ video: true, audio: true }).then(stream => {
            addVideoStream(myVideo, stream);

            peer.on('call', call => {
                call.answer(stream);
                const video = document.createElement('video');
                call.on('stream', userVideoStream => {
                    addVideoStream(video, userVideoStream);
                });
            });

            window.connectToPeer = () => {
                const id = document.getElementById('peer-id').value;
                const call = peer.call(id, stream);
                const video = document.createElement('video');
                call.on('stream', userVideoStream => {
                    addVideoStream(video, userVideoStream);
                });
            }
        });

        peer.on('open', id => {
            document.getElementById('my-id').innerText = id;
        });

        function addVideoStream(video, stream) {
            video.srcObject = stream;
            video.addEventListener('loadedmetadata', () => {
                video.play();
            });
            videoGrid.append(video);
        }
    </script>
</body>
</html>
